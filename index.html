<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- First load the D3 javascript library: -->
    <script type="text/javascript" src="lib/d3.min.js"></script>
    <style>
    .chart {
      background-color: rgb(245, 245, 245);
      padding: 5px;
    }
    .chart rect {
      fill: steelblue;
    }
    .chart text {
      fill: white;
      font: 9px sans-serif;
      text-anchor: end;
    }
    .axis text {
        fill: black;
        font: 9px sans-serif;
    }
    .axis path, .axis line {
        fill: none;
        stroke: rgb(180, 100, 100);
    }
    .mapSVG {
      background-color: rgb(250, 250, 250);
    }
    .municipality {
      fill: rgb(255, 240, 214);
      stroke: rgb(255, 159, 227);
    }
    .propCircle {
      fill: rgb(255, 0, 0);
      opacity: 0.5;
    }
  </style>
</head>
<body>
    <svg class="chart"></svg>
    <script type="text/javascript">
    d3.csv("data/overijssel_population.csv").then(function (data) {
        // in here is the callback function, inside it you have access to the loaded data object
        let svgwidth = 500;
        let barHeight = 20;
        let svgheight = barHeight * data.length;
        let xScale = d3.scaleLinear()
            .domain([0, d3.max(data, function (d) { return +d.aant_inw })])
            .range([0, svgwidth]);
            let theAxis = d3.axisBottom(xScale);
        let chart = d3.select("svg")
            .attr("width", svgwidth)
            .attr("height", svgheight + 30);
        let bar = chart.selectAll("g")
            .data(data)
            .enter().append("g")
            .attr("transform", function (d, i) { return "translate(0," + i * barHeight + ")"; }) ;
        bar.append("rect")
          .attr("width", function (d) { return xScale(+d.aant_inw) })
          .attr("height", barHeight - 1);
        bar.append("text") //this is code for the OPTIONAL challenge (names in bars)
          .attr("x", function(d) { return xScale(d.aant_inw) - 3 })
          .attr("y", barHeight / 2)
          .text(function(d) { return d.gm_naam; });
        chart.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(0," + svgheight + ")")
          .call(theAxis);
        } //end of callback function .then()
    ); //end of d3.csv
    </script>
    <svg class="mapSVG"></svg>
    <script type="text/javascript">
      let rScale;
      let mapWidth = 400, mapHeight = 350;
      let mapSVG = d3.select("svg")
        .attr("width", mapWidth)
        .attr("height", mapHeight);
      // Define Mercator proj to center at data (lon-lat):
      let myProj = d3.geoMercator()
        .center([6.40, 52.48])
        .scale(16000)
        .translate([mapWidth / 2, mapHeight / 2]);
      //Define svg path generator using the projection
      let svgpath = d3.geoPath().projection(myProj);
      // asynchronously load geojson:
      d3.json("data/overijssel.json").then(function(geojson) {
          mapSVG.selectAll("path")
            .data(geojson.features).enter()
          // for each d create an svgpath that uses the geoPath generator:
            .append("path")
            .attr("class", "municipality")
            .attr("d", svgpath);
          // create scale to map data (0-max) to radius (0-50):
          rScale = d3.scaleLinear()
            .domain([0,
              d3.max(geojson.features, function (d) { return d.properties.aant_inw  })
            ])
            .range([0, 50]);
          // another layer for the circles:
          mapSVG.selectAll("circle")
            .data(geojson.features).enter()
            // for each d create a circle:
            .append("circle")
            .attr("class", "propCircle")
            // calculates centroid X of geo path :
            .attr("cx", function (d) { return svgpath.centroid(d)[0] })
            // calculates centroid Y of geo path:
            .attr("cy", function (d) { return svgpath.centroid(d)[1] })
            // set r using rScale:
            .attr("r", function (d) { return rScale(+d.properties.aant_inw) })
        } //end of callback function .then()
      ); //end of d3.json
    </script>

    
</body>
</html>